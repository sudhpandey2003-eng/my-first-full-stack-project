<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Full-Stack To-Do App</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Use Inter font family -->
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
        }
    </style>
</head>
<body class="min-h-screen flex items-start justify-center p-4 bg-gray-100">

    <div class="w-full max-w-lg mt-10">
        <!-- App Header -->
        <header class="text-center mb-6">
            <h1 class="text-4xl font-extrabold text-indigo-700">My First Full-Stack Project</h1>
            <p class="text-lg text-gray-600 mt-2">To-Do List (JS Frontend + Local Persistence)</p>
        </header>

        <!-- Loading Indicator/Error Message Box -->
        <div id="message-box" class="hidden p-3 mb-4 rounded-lg shadow-md font-medium text-sm transition-all duration-300"></div>

        <!-- Add New To-Do Form -->
        <div class="bg-white p-6 rounded-xl shadow-2xl mb-6">
            <form id="add-todo-form" class="flex flex-col sm:flex-row space-y-3 sm:space-y-0 sm:space-x-3">
                <input
                    type="text"
                    id="todo-input"
                    placeholder="What needs to be done?"
                    required
                    class="flex-grow p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 text-gray-700 transition duration-150"
                >
                <button
                    type="submit"
                    class="p-3 bg-indigo-600 text-white font-semibold rounded-lg shadow-md hover:bg-indigo-700 focus:outline-none focus:ring-4 focus:ring-indigo-500 focus:ring-opacity-50 transition duration-150"
                >
                    Add Task
                </button>
            </form>
        </div>

        <!-- To-Do List Container -->
        <div class="bg-white rounded-xl shadow-2xl p-4">
            <h2 class="text-2xl font-bold text-gray-800 mb-4 border-b pb-2">Tasks</h2>
            <ul id="todo-list" class="divide-y divide-gray-200">
                <!-- To-Do items will be inserted here by JavaScript -->
                <li class="text-gray-500 p-3 text-center" id="empty-state">Loading tasks...</li>
            </ul>
        </div>
        
    </div>

    <script>
        // --- Configuration and Utilities ---
        const todoList = document.getElementById('todo-list');
        const todoForm = document.getElementById('add-todo-form');
        const todoInput = document.getElementById('todo-input');
        const emptyState = document.getElementById('empty-state');
        const messageBox = document.getElementById('message-box');
        const STORAGE_KEY = 'local-todos-data'; // Key for local storage persistence

        /**
         * Displays a temporary success or error message.
         * @param {string} message - The message text.
         * @param {string} type - 'success' or 'error'.
         */
        function showMessage(message, type) {
            messageBox.textContent = message;
            messageBox.className = 'p-3 mb-4 rounded-lg shadow-md font-medium text-sm transition-all duration-300';
            messageBox.classList.remove('hidden');

            if (type === 'success') {
                messageBox.classList.add('bg-green-100', 'text-green-800', 'border-l-4', 'border-green-500');
            } else if (type === 'error') {
                messageBox.classList.add('bg-red-100', 'text-red-800', 'border-l-4', 'border-red-500');
            } else {
                 messageBox.classList.add('bg-blue-100', 'text-blue-800', 'border-l-4', 'border-blue-500');
            }

            // Hide after 3 seconds
            setTimeout(() => {
                messageBox.classList.add('hidden');
            }, 3000);
        }
        
        // --- Local Storage Implementation (Mock Backend) ---

        /**
         * Reads todos from local storage.
         * @returns {Array} The list of to-do items.
         */
        function getTodosFromStorage() {
            try {
                const data = localStorage.getItem(STORAGE_KEY);
                return data ? JSON.parse(data) : [];
            } catch (e) {
                console.error("Error reading from local storage:", e);
                return [];
            }
        }

        /**
         * Writes todos to local storage.
         * @param {Array} todos - The list of to-do items to write.
         */
        function saveTodosToStorage(todos) {
            try {
                localStorage.setItem(STORAGE_KEY, JSON.stringify(todos));
            } catch (e) {
                console.error("Error writing to local storage:", e);
            }
        }

        /**
         * Adds a new todo item to storage.
         */
        function addTodoToStorage(text) {
            const todos = getTodosFromStorage();
            const newTodo = {
                // Use timestamp as a simple unique ID
                id: Date.now(), 
                text: text,
                completed: false,
            };
            todos.push(newTodo);
            saveTodosToStorage(todos);
            return newTodo;
        }

        /**
         * Toggles the completion status of a todo item in storage.
         */
        function toggleTodoInStorage(id, completed) {
            const todos = getTodosFromStorage();
            // Ensure ID is treated as a number for comparison
            const index = todos.findIndex(t => t.id === Number(id)); 
            if (index !== -1) {
                todos[index].completed = completed;
                saveTodosToStorage(todos);
            }
        }
        
        /**
         * Deletes a todo item from storage.
         */
        function deleteTodoFromStorage(id) {
            let todos = getTodosFromStorage();
            const initialLength = todos.length;
            // Ensure ID is treated as a number for comparison
            todos = todos.filter(t => t.id !== Number(id)); 
            saveTodosToStorage(todos);
            return todos.length < initialLength;
        }

        // --- Core Application Logic (Now using Local Storage) ---

        /**
         * Renders the entire list of to-do items to the DOM.
         * @param {Array<Object>} todos - The list of to-do items.
         */
        function renderTodos(todos) {
            todoList.innerHTML = ''; // Clear existing list

            if (todos.length === 0) {
                emptyState.textContent = 'You have no tasks! Add one above.';
                emptyState.classList.remove('hidden');
                todoList.appendChild(emptyState);
                return;
            }

            // Hide the empty state message
            emptyState.classList.add('hidden');


            todos.forEach(todo => {
                const li = document.createElement('li');
                li.className = 'flex items-center justify-between p-3 transition duration-200 hover:bg-gray-50';
                li.dataset.id = todo.id;

                const isCompleted = todo.completed;
                const textClasses = isCompleted 
                    ? 'line-through text-gray-400' 
                    : 'text-gray-800';

                li.innerHTML = `
                    <div class="flex items-center space-x-3 flex-grow">
                        <!-- Checkbox for toggling completion status -->
                        <input 
                            type="checkbox" 
                            ${isCompleted ? 'checked' : ''} 
                            class="todo-toggle h-5 w-5 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500 cursor-pointer"
                            data-id="${todo.id}"
                        >
                        <!-- To-Do text -->
                        <span class="text-lg ${textClasses} break-all">${todo.text}</span>
                    </div>
                    <!-- Delete Button -->
                    <button 
                        class="todo-delete ml-4 p-2 text-red-500 hover:text-red-700 rounded-full hover:bg-red-50 transition duration-150" 
                        data-id="${todo.id}"
                        aria-label="Delete task"
                    >
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3m-5 3h14"></path></svg>
                    </button>
                `;
                todoList.appendChild(li);
            });
        }

        /**
         * Fetches all to-do items from local storage and updates the UI.
         */
        function fetchTodos() {
            emptyState.textContent = 'Loading tasks...';
            emptyState.classList.remove('hidden');
            
            try {
                const todos = getTodosFromStorage();
                renderTodos(todos);
                // Inform user about local persistence instead of network fetch
                showMessage('Tasks loaded from browser storage.', 'success'); 
            } catch (error) {
                console.error('Local Storage error:', error);
                showMessage('Failed to load tasks from browser storage.', 'error');
                emptyState.textContent = 'Failed to load tasks. Check console for details.';
            }
        }

        /**
         * Handles the submission of the new to-do form.
         */
        async function handleAddTodo(event) {
            event.preventDefault();
            const text = todoInput.value.trim();

            if (!text) {
                showMessage('Please enter a task description.', 'error');
                return;
            }

            try {
                // Add to local storage
                addTodoToStorage(text);
                
                todoInput.value = ''; // Clear input
                fetchTodos();
                showMessage('Task added successfully.', 'success');
                
            } catch (error) {
                console.error('Add To-Do error:', error);
                showMessage('An unexpected error occurred while adding the task.', 'error');
            }
        }

        /**
         * Handles toggling the completion status of a to-do item.
         */
        async function handleToggleTodo(id, isCompleted) {
            try {
                // Toggle in local storage
                toggleTodoInStorage(id, isCompleted);
                fetchTodos(); // Refresh UI
            } catch (error) {
                console.error('Toggle To-Do error:', error);
                showMessage('An unexpected error occurred while toggling the task.', 'error');
            }
        }

        /**
         * Handles the deletion of a to-do item.
         */
        async function handleDeleteTodo(id) {
            // Note: Using window.confirm for simplicity, but a custom modal is better practice.
            const confirmed = window.confirm("Are you sure you want to delete this task?"); 

            if (!confirmed) return;
            
            try {
                // Delete from local storage
                const deleted = deleteTodoFromStorage(id);

                if (deleted) {
                    fetchTodos(); // Refresh UI
                    showMessage('Task deleted successfully.', 'success');
                } else {
                     showMessage('Task not found.', 'error');
                     fetchTodos(); // Ensure UI is consistent
                }
            } catch (error) {
                console.error('Delete To-Do error:', error);
                showMessage('An unexpected error occurred while deleting the task.', 'error');
            }
        }

        // --- Event Listeners and Initialization ---

        // Listen for form submission to add new tasks
        todoForm.addEventListener('submit', handleAddTodo);

        // Event delegation for toggling and deleting tasks
        todoList.addEventListener('click', (event) => {
            const target = event.target;
            // Find the closest element with a data-id, which represents the todo item
            const todoElement = target.closest('li[data-id], input.todo-toggle, button.todo-delete');
            const id = todoElement ? todoElement.dataset.id : null;

            if (target.classList.contains('todo-toggle') && id) {
                // Toggle completion status
                handleToggleTodo(id, target.checked);
            } else if (target.closest('.todo-delete') && id) {
                // Delete task
                handleDeleteTodo(id);
            }
        });

        // Initial fetch of the To-Do list on page load
        document.addEventListener('DOMContentLoaded', fetchTodos);
    </script>
</body>
</html>